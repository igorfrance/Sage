<!DOCTYPE html>
<html
	xmlns:sage="http://www.cycle99.com/schemas/sage/sage.xsd"
	xmlns:mod="http://www.cycle99.com/schemas/sage/modules.xsd"
 	xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<sage:basehref/>
		<title>Node handlers</title>
	</head>
	<body>

		<div class="page">
			<mod:Sidebar>
				<mod:config>
					<mod:current><sage:url ref="extensibility-node-handlers"/></mod:current>
				</mod:config>
			</mod:Sidebar>
			<section class="content">
				<header>
					<span>Node handlers</span>
				</header>
				<details>

					<summary>
						Node handlers are registered delegate functions invoked during the <a href="url:link(xml-flow-copy-tree)">contextualization step</a> when tree processing encounters an element
						or an attribute whose local name and namespace uri match the delegate.
					</summary>

					<section class="topic">
						<details>
							<p>
								During the <a href="url:link(xml-flow-copy-tree)">contextualization step</a> of
								<a href="url:link(xml-flow)">document processing</a>, Sage processes all XML elements and their attributes
								in the opened document, recursiverly traversing the whole document.
							</p>
							<p>
								This means that each element, attribute and text node in an XML document is processed
								by either the default handler - whose function is to simply copy the node as-is; or by another, more specific
								handler registered for this node.
							</p>

							<h6 class="caption">NodeHandler delegate signature</h6>
							<mod:SyntaxHighlighter>
								<mod:config>
									<mod:language>csharp</mod:language>
									<mod:digits>2</mod:digits>
									<mod:keywords>
										<mod:group name="type">
											XmlNode|SageContext
										</mod:group>
									</mod:keywords>
									<mod:code>

										delegate XmlNode NodeHandler(XmlNode node, SageContext context);

									</mod:code>
								</mod:config>
							</mod:SyntaxHighlighter>

							<h6 class="caption">NodeHandler delegate implementation and registration</h6>
							<mod:SyntaxHighlighter>
								<mod:config>
									<mod:language>csharp</mod:language>
									<mod:keywords>
										<mod:group name="type">
											NodeHandler|SageContext|XmlNode|XmlNamespaces|XmlElement
										</mod:group>
										<mod:group name="enum">
											XmlNodeType
										</mod:group>
										<mod:group name="value">
											Element
										</mod:group>
									</mod:keywords>
									<mod:code>

										[NodeHandler(XmlNodeType.Element, "value", "http://www.cycle99.com/schemas/sage/contextualization.xsd")]
										internal static XmlNode ProcessContextValueNode(XmlNode valueElement, SageContext context)
										{
											if (valueElement.SelectSingleElement("ancestor::sage:literal", XmlNamespaces.Manager) != null)
												return valueElement;

											XmlElement valueElem = (XmlElement) valueElement;

											string propName = valueElem.GetAttribute("property");
											string propKey = valueElem.GetAttribute("key");
											string propValue = GetContextProperty(context, propName, propKey);

											if (propValue != null)
												return valueElement.OwnerDocument.CreateTextNode(propValue);

											return valueElement;
										}

									</mod:code>
								</mod:config>
							</mod:SyntaxHighlighter>
						</details>
					</section>

					<section class="topic">
						<header>Node handlers provided by Sage</header>
						<details>
							<summary>
								When processing the XML tree, when the element or attribute on the left
							</summary>
							<table class="definition">
								<colgroup>
									<col width="160"/>
									<col/>
								</colgroup>
								<thead>
									<tr>
										<th>Node</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody>
									<tr valign="top">
										<th><a href="url:link(sage-namespaces-sage,#sage:link)"><code>&lt;sage:link/&gt;</code></a></th>
										<td>
											This element gets its <code>href</code> attribute set, as resolved from reading the it's other attributes.
											Read more about it in <a href="url:link(linking)">linking</a>.
										</td>
									</tr>
									<tr valign="top">
										<th><code>&lt;sage:url/&gt;</code></th>
										<td>
											This element gets substituted with URL text as resolved from it's attributes.
											Read more about it in <a href="url:link(linking)">linking</a>.
										</td>
									</tr>
									<tr valign="top">
										<th><code>@sage:attrib</code></th>
										<td>
										This universal attribute is used to instruct Sage to generate the value of another attribute. The value of the attribute is
										Read more about it in <a href="url:link(linking)">linking</a>.
										</td>
									</tr>
								</tbody>
							</table>
						</details>
					</section>

				</details>
			</section>
		</div>
	</body>
</html>
